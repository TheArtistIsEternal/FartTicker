
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fart Ticker ‚Äì Multi Asset</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 2em; background: #111; color: #fff; }
    h1 { font-size: 2em; }
    #prices { margin: 1em 0; }
    .ticker-buttons button {
      margin: 0.5em;
      padding: 0.7em 1.2em;
      font-size: 1em;
      border: none;
      border-radius: 8px;
      background: #222;
      color: #fff;
      cursor: pointer;
    }
    .ticker-buttons button:hover {
      background: lime;
      color: black;
    }
    button#play {
      margin-top: 2em;
      padding: 1em 2em;
      font-size: 1.2em;
      background: lime;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .donate { margin-top: 3em; }
  </style>
</head>
<body>

  <h1>üí® Fart Ticker</h1>

  <div class="ticker-buttons">
    <button onclick="setAsset('bitcoin')">Bitcoin</button>
    <button onclick="setAsset('ethereum')">Ethereum</button>
    <button onclick="setAsset('^IXIC')">NASDAQ</button>
    <button onclick="setAsset('^GSPC')">S&P 500</button>
    <button onclick="setAsset('^DJI')">DOW</button>
    <button onclick="setAsset('^VIX')">VIX</button>
  </div>

  <div id="prices">
    <p>Loading...</p>
  </div>

  <button id="play" onclick="playStretched()">‚ñ∂Ô∏è Play Sound</button>

  <div class="donate">
    <a href="https://www.buymeacoffee.com/fartticker" target="_blank">
      <img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee" style="height: 50px !important;width: 217px !important;">
    </a>
  </div>

  <script>
    let percentChange = 0;
    let currentAsset = 'bitcoin';

    async function fetchCoinGecko(asset) {
      const res = await fetch(`https://api.coingecko.com/api/v3/coins/${asset}`);
      const data = await res.json();
      const price = data.market_data.current_price.usd;
      const change = data.market_data.price_change_percentage_24h;
      updatePriceDisplay(asset, price, change);
    }

    async function fetchYahooFinance(symbol) {
      const query = await fetch(`https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?range=1d&interval=1d`);
      const data = await query.json();
      const result = data.chart.result[0];
      const prices = result.indicators.quote[0].close;
      const change = ((prices[prices.length - 1] - prices[0]) / prices[0]) * 100;
      updatePriceDisplay(symbol, prices[prices.length - 1], change);
    }

    function updatePriceDisplay(asset, price, change) {
      percentChange = parseFloat(change.toFixed(2));
      document.getElementById('prices').innerHTML = `
        <p>üìà ${asset.toUpperCase()}</p>
        <p>üí∞ Current Price: $${price.toFixed(2)}</p>
        <p><strong>Change: ${percentChange}%</strong></p>
      `;
    }

    function setAsset(asset) {
      currentAsset = asset;
      if (asset === 'bitcoin' || asset === 'ethereum') {
        fetchCoinGecko(asset);
      } else {
        fetchYahooFinance(asset);
      }
    }

    async function playStretched() {
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const isUp = percentChange >= 0;
      const file = isUp ? 'FART_1SEC_FORWARD.mp3' : 'FART_1SEC_REVERSE.mp3';
      const response = await fetch(file);
      const arrayBuffer = await response.arrayBuffer();
      const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);

      const source = audioContext.createBufferSource();
      source.buffer = audioBuffer;

      let stretch = 1 + Math.abs(percentChange);
      source.playbackRate.value = 1 / stretch;

      source.connect(audioContext.destination);
      source.start();
    }

    setAsset('bitcoin');
  </script>
</body>
</html>
